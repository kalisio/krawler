<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Hooks | Krawler</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="https://s3.eu-central-1.amazonaws.com/kalisioscope/krawler/krawler-icon-64x64.png">
    <link rel="manifest" href="/krawler/manifest.json">
    <meta name="description" content="A minimalist Geospatial ETL">
    
    <link rel="preload" href="/krawler/assets/css/0.styles.dd0a2e58.css" as="style"><link rel="preload" href="/krawler/assets/js/app.800cd291.js" as="script"><link rel="preload" href="/krawler/assets/js/3.b3661107.js" as="script"><link rel="preload" href="/krawler/assets/js/23.155a1fbd.js" as="script"><link rel="preload" href="/krawler/assets/js/4.26c8de0e.js" as="script"><link rel="prefetch" href="/krawler/assets/js/10.89bd5b33.js"><link rel="prefetch" href="/krawler/assets/js/11.1ce39713.js"><link rel="prefetch" href="/krawler/assets/js/12.77f43dde.js"><link rel="prefetch" href="/krawler/assets/js/13.9b1ad182.js"><link rel="prefetch" href="/krawler/assets/js/14.e89a29b9.js"><link rel="prefetch" href="/krawler/assets/js/15.c046756f.js"><link rel="prefetch" href="/krawler/assets/js/16.0d5e83f7.js"><link rel="prefetch" href="/krawler/assets/js/17.b1d8058c.js"><link rel="prefetch" href="/krawler/assets/js/18.7e141bcf.js"><link rel="prefetch" href="/krawler/assets/js/19.ba10a357.js"><link rel="prefetch" href="/krawler/assets/js/2.564c5686.js"><link rel="prefetch" href="/krawler/assets/js/20.b401f8bb.js"><link rel="prefetch" href="/krawler/assets/js/21.c9a05651.js"><link rel="prefetch" href="/krawler/assets/js/22.fea26fe0.js"><link rel="prefetch" href="/krawler/assets/js/24.4edaa938.js"><link rel="prefetch" href="/krawler/assets/js/25.1e6c4272.js"><link rel="prefetch" href="/krawler/assets/js/26.6d1beb93.js"><link rel="prefetch" href="/krawler/assets/js/27.d2f53065.js"><link rel="prefetch" href="/krawler/assets/js/28.d52cbba5.js"><link rel="prefetch" href="/krawler/assets/js/29.64d6d174.js"><link rel="prefetch" href="/krawler/assets/js/5.9b3d90bc.js"><link rel="prefetch" href="/krawler/assets/js/6.1a872ecd.js"><link rel="prefetch" href="/krawler/assets/js/7.e86c7666.js"><link rel="prefetch" href="/krawler/assets/js/8.00bcd0e5.js"><link rel="prefetch" href="/krawler/assets/js/9.bc01efbe.js">
    <link rel="stylesheet" href="/krawler/assets/css/0.styles.dd0a2e58.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/krawler/" class="home-link router-link-active"><!----> <span class="site-name">Krawler</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/krawler/about/introduction.html" class="nav-link">
  About
</a></div><div class="nav-item"><a href="/krawler/guides/understanding-krawler.html" class="nav-link">
  Guides
</a></div><div class="nav-item"><a href="/krawler/reference/services.html" class="nav-link">
  Reference
</a></div><div class="nav-item"><a href="/krawler/examples/" class="nav-link">
  Examples
</a></div><div class="nav-item"><a href="https://github.com/kalisio/krawler" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/krawler/about/introduction.html" class="nav-link">
  About
</a></div><div class="nav-item"><a href="/krawler/guides/understanding-krawler.html" class="nav-link">
  Guides
</a></div><div class="nav-item"><a href="/krawler/reference/services.html" class="nav-link">
  Reference
</a></div><div class="nav-item"><a href="/krawler/examples/" class="nav-link">
  Examples
</a></div><div class="nav-item"><a href="https://github.com/kalisio/krawler" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav> <p align="center"><a href="https://kalisio.com"><img src="https://s3.eu-central-1.amazonaws.com/kalisioscope/kalisio/kalisio-logo-black-256x84.png"></a> <br> <!----></p> <ul class="sidebar-links"><li><a href="/krawler/reference/services.html" class="sidebar-link">Services</a></li><li><a href="/krawler/reference/hooks.html" aria-current="page" class="active sidebar-link">Hooks</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/krawler/reference/hooks.html#common-options" class="sidebar-link">Common options</a></li><li class="sidebar-sub-header"><a href="/krawler/reference/hooks.html#authentication" class="sidebar-link">Authentication</a></li><li class="sidebar-sub-header"><a href="/krawler/reference/hooks.html#clearing" class="sidebar-link">Clearing</a></li><li class="sidebar-sub-header"><a href="/krawler/reference/hooks.html#csv" class="sidebar-link">CSV</a></li><li class="sidebar-sub-header"><a href="/krawler/reference/hooks.html#docker" class="sidebar-link">Docker</a></li><li class="sidebar-sub-header"><a href="/krawler/reference/hooks.html#ftp" class="sidebar-link">FTP</a></li><li class="sidebar-sub-header"><a href="/krawler/reference/hooks.html#geographic-grid" class="sidebar-link">Geographic grid</a></li><li class="sidebar-sub-header"><a href="/krawler/reference/hooks.html#json" class="sidebar-link">JSON</a></li><li class="sidebar-sub-header"><a href="/krawler/reference/hooks.html#geojson" class="sidebar-link">GeoJSON</a></li><li class="sidebar-sub-header"><a href="/krawler/reference/hooks.html#kml" class="sidebar-link">KML</a></li><li class="sidebar-sub-header"><a href="/krawler/reference/hooks.html#mongodb" class="sidebar-link">MongoDB</a></li><li class="sidebar-sub-header"><a href="/krawler/reference/hooks.html#feathers" class="sidebar-link">Feathers</a></li><li class="sidebar-sub-header"><a href="/krawler/reference/hooks.html#numerical-weather-prediction" class="sidebar-link">Numerical Weather Prediction</a></li><li class="sidebar-sub-header"><a href="/krawler/reference/hooks.html#ogc" class="sidebar-link">OGC</a></li><li class="sidebar-sub-header"><a href="/krawler/reference/hooks.html#postgresql" class="sidebar-link">PostgreSQL</a></li><li class="sidebar-sub-header"><a href="/krawler/reference/hooks.html#raster" class="sidebar-link">Raster</a></li><li class="sidebar-sub-header"><a href="/krawler/reference/hooks.html#store" class="sidebar-link">Store</a></li><li class="sidebar-sub-header"><a href="/krawler/reference/hooks.html#system" class="sidebar-link">System</a></li><li class="sidebar-sub-header"><a href="/krawler/reference/hooks.html#txt" class="sidebar-link">TXT</a></li><li class="sidebar-sub-header"><a href="/krawler/reference/hooks.html#utils" class="sidebar-link">Utils</a></li><li class="sidebar-sub-header"><a href="/krawler/reference/hooks.html#xml" class="sidebar-link">XML</a></li><li class="sidebar-sub-header"><a href="/krawler/reference/hooks.html#yaml" class="sidebar-link">YAML</a></li></ul></li><li><a href="/krawler/reference/known-issues.html" class="sidebar-link">Known issues</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="hooks"><a href="#hooks" class="header-anchor">#</a> Hooks</h1> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Although all are not applicable, <a href="https://auk.docs.feathersjs.com/api/hooks-common.html" target="_blank" rel="noopener noreferrer">common FeathersJS hooks<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> are exposed in addition to krawler hooks and can be used in jobs, e.g. you can add <code>disallow: 'external'</code> to avoid exposing some services when deploying as a web app.</p></div> <h2 id="common-options"><a href="#common-options" class="header-anchor">#</a> Common options</h2> <p>All hooks can have the following options:</p> <ul><li><strong>match</strong>: a match filter to be applied on the input hook data using any option supported by <a href="https://github.com/crcn/sift.js" target="_blank" rel="noopener noreferrer">sift<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, fields can be templates, learn more about <a href="https://lodash.com/docs/4.17.4#template" target="_blank" rel="noopener noreferrer">templating<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, if the data is filtered the hook will not be applied</li> <li><strong>predicate</strong>: an additional predicate function taking the hook item as input and returning true if matching occurs (can be async)</li> <li><strong>faultTolerant</strong>: will catch any error raised in the hook so that the hook chain will continue anyway</li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Due to templating restricted to string output any ISO date string or comparison operator value in the match filter will be converted back to native types so that matching will work as expected in JS</p> <p>Matching is for instance useful when you'd like to apply a hook to only a subset of your tasks, e.g. all the CSV files but not the JSON files.</p> <p>Fault tolerance is for instance useful when you use unreliable data sources and you don't want the job to stop when some requests fail.</p></div> <p>All input/output hooks and store hooks manipulating items, i.e. reading/writing/transforming/removing data in a store like <code>readJson</code>, <code>writeJson</code> or <code>gzipToStore</code>, can have the following options:</p> <ul><li><strong>storePath</strong>: property path where to read the store to be used on the hook object or params, defaults to <code>data.store</code></li> <li><strong>store</strong>: property containing the ID of the store to be used, not defined by default</li> <li><strong>key</strong>: input/output key for the file in store, can be a template with item as context, learn more about <a href="https://lodash.com/docs/4.17.4#template" target="_blank" rel="noopener noreferrer">templating<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><strong>storageOptions</strong>: write options for the underlying store</li></ul> <h2 id="authentication"><a href="#authentication" class="header-anchor">#</a> Authentication</h2> <p><a href="https://github.com/kalisio/krawler/blob/master/src/hooks/hooks.auth.js" target="_blank" rel="noopener noreferrer">source<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="basicauth-options"><a href="#basicauth-options" class="header-anchor">#</a> basicAuth(options)</h3> <p>Add header to HTTP requests for basic authorization, hook options are the following:</p> <ul><li><strong>type</strong>: type of authorization used as the key in the header, defaults to <code>Authorization</code> but could be changed to <code>Proxy-Authorization</code> for instance</li> <li><strong>optionsPath</strong>: the property path to the request options that contains the authorization options, defaults to <code>options</code></li></ul> <p>The authorization options have to be structured like this, e.g. on a task (or similarly on a task template in a job):</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">httpTask</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'http'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// Target request URL</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'xxx'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">auth</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// Your user identity</span>
      <span class="token literal-property property">user</span><span class="token operator">:</span> <span class="token string">'yyy'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">password</span><span class="token operator">:</span> <span class="token string">'zzz'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="oauth-options"><a href="#oauth-options" class="header-anchor">#</a> OAuth(options)</h3> <p>Add header with a token retrieved from an OAuth authorization server to HTTP requests, hook options are the following:</p> <ul><li><strong>type</strong>: type of authorization used as the key in the header, defaults to <code>Authorization</code> but could be changed to <code>Proxy-Authorization</code> for instance</li> <li><strong>optionsPath</strong>: the property path to the request options that contains the authorization options, defaults to <code>options</code></li></ul> <p>The authorization options have to be structured like this, e.g. on a task (or similarly on a task template in a job):</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">httpTask</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'http'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// Target request URL</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'www'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">oauth</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// Token endpoint</span>
      <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'xxx'</span><span class="token punctuation">,</span>
      <span class="token comment">// Your client identity</span>
      <span class="token literal-property property">client_id</span><span class="token operator">:</span> <span class="token string">'yyy'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">client_secret</span><span class="token operator">:</span> <span class="token string">'zzz'</span><span class="token punctuation">,</span>
      <span class="token comment">// Client authentication method to be used to get access token</span>
      <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'client_secret_post'</span> <span class="token comment">// Or 'client_secret_basic'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="clearing"><a href="#clearing" class="header-anchor">#</a> Clearing</h2> <p><a href="https://github.com/kalisio/krawler/blob/master/src/hooks/hooks.clear.js" target="_blank" rel="noopener noreferrer">source<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="clearoutputs-options"><a href="#clearoutputs-options" class="header-anchor">#</a> clearOutputs(options)</h3> <p>Clear output files generated by tasks and hooks, hook options are the following:</p> <ul><li><strong>storePath</strong>: see description in <a href="/krawler/reference/hooks.html#common-options">common options</a></li> <li><strong>store</strong>: see description in <a href="/krawler/reference/hooks.html#common-options">common options</a></li> <li><strong>type</strong>: the type of output to be cleared by this hook, defaults to <code>intermediate</code></li></ul> <h3 id="cleardata-options"><a href="#cleardata-options" class="header-anchor">#</a> clearData(options)</h3> <p>Clear output data generated by hooks, hook options are the following:</p> <ul><li><strong>dataPath</strong>: property path to clean on the hook object, defaults to <code>result.data</code></li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Use this hook if you load large datasets (e.g. JSON files) because all hook data are still referenced in memory until the job is finished</p></div> <h2 id="csv"><a href="#csv" class="header-anchor">#</a> CSV</h2> <p><a href="https://github.com/kalisio/krawler/blob/master/src/hooks/hooks.csv.js" target="_blank" rel="noopener noreferrer">source<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="readcsv-options"><a href="#readcsv-options" class="header-anchor">#</a> readCSV(options)</h3> <p>Read a CSV from an input stream/store and convert it to in-memory JSON values, hook options are the following:</p> <ul><li><strong>dataPath</strong>: property path where to store the resulting JSON object on the hook object, defaults to <code>result.data</code></li> <li><strong>storePath</strong>: see description in <a href="/krawler/reference/hooks.html#common-options">common options</a></li> <li><strong>store</strong>: see description in <a href="/krawler/reference/hooks.html#common-options">common options</a></li> <li><strong>key</strong>: see description in <a href="/krawler/reference/hooks.html#common-options">common options</a></li> <li>any option supported by <a href="https://github.com/C2FO/fast-csv#parsing" target="_blank" rel="noopener noreferrer">fast-csv<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h3 id="writecsv-options"><a href="#writecsv-options" class="header-anchor">#</a> writeCSV(options)</h3> <p>Generate a CSV file from in-memory JSON values, hook options are the following:</p> <ul><li><strong>dataPath</strong>: property path where to read the input JSON object on the hook object, defaults to <code>result</code></li> <li><strong>storePath</strong>: see description in <a href="/krawler/reference/hooks.html#common-options">common options</a></li> <li><strong>store</strong>: see description in <a href="/krawler/reference/hooks.html#common-options">common options</a></li> <li><strong>key</strong>: see description in <a href="/krawler/reference/hooks.html#common-options">common options</a></li> <li><strong>outputType</strong>: the type of output produced by this hook, defaults to <code>intermediate</code></li> <li>any option supported by <a href="https://github.com/C2FO/fast-csv#parsing" target="_blank" rel="noopener noreferrer">fast-csv<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h3 id="mergecsv-options"><a href="#mergecsv-options" class="header-anchor">#</a> mergeCSV(options)</h3> <p>Generate a CSV file from a set of input CSV files, hook options are the following:</p> <ul><li><strong>storePath</strong>: see description in <a href="/krawler/reference/hooks.html#common-options">common options</a></li> <li><strong>store</strong>: see description in <a href="/krawler/reference/hooks.html#common-options">common options</a></li> <li><strong>mergeKey</strong>: input key for the CSV files to be merged in store, must be a template with item as context, learn more about <a href="https://lodash.com/docs/4.17.4#template" target="_blank" rel="noopener noreferrer">templating<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><strong>key</strong>: see description in <a href="/krawler/reference/hooks.html#common-options">common options</a></li> <li><strong>outputType</strong>: the type of output produced by this hook, defaults to <code>intermediate</code></li> <li>any option supported by <a href="https://github.com/C2FO/fast-csv#parsing" target="_blank" rel="noopener noreferrer">fast-csv<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>The input hook result is expected to be an array of tasks which output will be read back from the store.</p> <h2 id="docker"><a href="#docker" class="header-anchor">#</a> Docker</h2> <p><a href="https://github.com/kalisio/krawler/blob/master/src/hooks/hooks.docker.js" target="_blank" rel="noopener noreferrer">source<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>The Docker hooks allows you to interact with a Docker daemon. It is based on <a href="https://github.com/apocas/dockerode" target="_blank" rel="noopener noreferrer">dockerode<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, a Docker remote API.</p> <h3 id="connectdocker-options"><a href="#connectdocker-options" class="header-anchor">#</a> connectDocker(options)</h3> <p>Connect to the Docker daemon. The <a href="https://github.com/apocas/dockerode#getting-started" target="_blank" rel="noopener noreferrer">connection options<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> of the client are defined in the hook options plus:</p> <ul><li><strong>clientPath</strong>: property path where to store the client object to be used by the Docker hooks, defaults to <code>client</code></li></ul> <h3 id="disconnectdocker-options"><a href="#disconnectdocker-options" class="header-anchor">#</a> disconnectDocker(options)</h3> <p>Disconnect from the Docker daemon. Hook options are the following:</p> <ul><li><strong>clientPath</strong>: property path where to retrieve the client object, defaults to <code>client</code></li></ul> <h3 id="pulldockerimage-options"><a href="#pulldockerimage-options" class="header-anchor">#</a> pullDockerImage(options)</h3> <p>Pull a docker image. Hook options are the following:</p> <ul><li><strong>clientPath</strong>: property path where to retrieve the client object, defaults to <code>client</code></li> <li>any options supported by dockerode for <a href="https://github.com/apocas/dockerode#equivalent-of-docker-pull-in-dockerode" target="_blank" rel="noopener noreferrer">image pulling<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><strong>clientPath</strong>: property path where to retrieve the client object, defaults to <code>client</code></li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>options</code> can contain an <code>auth</code> object to pull the image from a private repository.</p></div> <h3 id="createdockercontainer-options"><a href="#createdockercontainer-options" class="header-anchor">#</a> createDockerContainer(options)</h3> <p>Run a docker container. Hook options are the following:</p> <ul><li><strong>clientPath</strong>: property path where to retrieve the client object, defaults to <code>client</code></li> <li>any options supported by dockerode for <a href="https://github.com/apocas/dockerode#manipulating-a-container" target="_blank" rel="noopener noreferrer">container creation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>Cmd</code> and <code>Env</code> options can be templates, learn more about <a href="https://lodash.com/docs/4.17.4#template" target="_blank" rel="noopener noreferrer">templating<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <h3 id="createdockerservice-options"><a href="#createdockerservice-options" class="header-anchor">#</a> createDockerService(options)</h3> <p>Create a docker service on a Swarm cluster. Hook options are the following:</p> <ul><li><strong>clientPath</strong>: property path where to retrieve the client object, defaults to <code>client</code></li> <li>any options supported by dockerode for <a href="https://github.com/apocas/dockerode#documentation" target="_blank" rel="noopener noreferrer">service creation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Options can be templates, learn more about <a href="https://lodash.com/docs/4.17.4#template" target="_blank" rel="noopener noreferrer">templating<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <h3 id="rundockercontainercommand-options"><a href="#rundockercontainercommand-options" class="header-anchor">#</a> runDockerContainerCommand(options)</h3> <p>Run a command against a docker container. Hook options are the following:</p> <ul><li><strong>clientPath</strong>: property path where to retrieve the client object, defaults to <code>client</code></li> <li><strong>command</strong>: the name of the command to be run</li> <li><strong>arguments</strong>: the arguments of the command to be run</li> <li>support any command/option supported by dockerode on <a href="https://github.com/apocas/dockerode#manipulating-a-container" target="_blank" rel="noopener noreferrer">containers<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>When the <code>getArchive</code> command is used, additional hook options are the following:</p> <ul><li><strong>storePath</strong>: see description in <a href="/krawler/reference/hooks.html#common-options">common options</a></li> <li><strong>store</strong>: see description in <a href="/krawler/reference/hooks.html#common-options">common options</a></li> <li><strong>key</strong>: see description in <a href="/krawler/reference/hooks.html#common-options">common options</a></li> <li><strong>outputType</strong>: the type of output produced by this hook, defaults to <code>intermediate</code></li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>Cmd</code>, <code>Env</code> and <code>path</code> options can be templates, learn more about <a href="https://lodash.com/docs/4.17.4#template" target="_blank" rel="noopener noreferrer">templating<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>The hook take care to wait for <code>exec</code> to finish and automatically write the tar in the hook store for <code>getArchive</code></p></div> <h2 id="ftp"><a href="#ftp" class="header-anchor">#</a> FTP</h2> <p><a href="https://github.com/kalisio/krawler/blob/master/src/hooks/hooks.ftp.js" target="_blank" rel="noopener noreferrer">source<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>FTP hooks rely on <a href="http://lftp.yar.ru/" target="_blank" rel="noopener noreferrer">lftp<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Consequently, uou need to have the executable <code>lftp</code> installed on your computer.</p></div> <h3 id="listftp-options"><a href="#listftp-options" class="header-anchor">#</a> listFTP(options)</h3> <p>List the files from a remote directory on the FTP server, hook options are the following:</p> <ul><li><strong>clientPath</strong>: property path where to retrieve the client object, defaults to <code>client</code></li> <li><strong>remoteDir</strong>: the remote directory to list</li> <li><strong>key</strong>: see description in <a href="/krawler/reference/hooks.html#common-options">common options</a></li></ul> <h3 id="globftp-options"><a href="#globftp-options" class="header-anchor">#</a> globFTP(options)</h3> <p>List the files from a remote directory with names matching a pattern, hook options are the following:</p> <ul><li><strong>clientPath</strong>: property path where to retrieve the client object, defaults to <code>client</code></li> <li><strong>remoteDir</strong>: the remote directory to list</li> <li><strong>key</strong>: see description in <a href="/krawler/reference/hooks.html#common-options">common options</a></li> <li><strong>pattern</strong>: the pattern use to match the file names, default to <code>*</code></li></ul> <h3 id="getftp-options"><a href="#getftp-options" class="header-anchor">#</a> getFTP(options)</h3> <p>Get a remote file from the FTP server, hook options are the following:</p> <ul><li><strong>clientPath</strong>: property path where to retrieve the client object, defaults to <code>client</code></li> <li><strong>remoteFile</strong>: the file to be copied on the FTP server</li> <li><strong>localFile</strong>: the destination file on the local host</li> <li><strong>storePath</strong>: see description in <a href="/krawler/reference/hooks.html#common-options">common options</a></li> <li><strong>store</strong>: see description in <a href="/krawler/reference/hooks.html#common-options">common options</a></li> <li><strong>key</strong>: see description in <a href="/krawler/reference/hooks.html#common-options">common options</a></li></ul> <h3 id="putftp-options"><a href="#putftp-options" class="header-anchor">#</a> putFTP(options)</h3> <p>Put a local file on the FTP server, hook options are the following:</p> <ul><li><strong>clientPath</strong>: property path where to retrieve the client object, defaults to <code>client</code></li> <li><strong>storePath</strong>: see description in <a href="/krawler/reference/hooks.html#common-options">common options</a></li> <li><strong>store</strong>: see description in <a href="/krawler/reference/hooks.html#common-options">common options</a></li> <li><strong>key</strong>: see description in <a href="/krawler/reference/hooks.html#common-options">common options</a></li></ul> <h2 id="geographic-grid"><a href="#geographic-grid" class="header-anchor">#</a> Geographic grid</h2> <p><a href="https://github.com/kalisio/krawler/blob/master/src/hooks/hooks.grid.js" target="_blank" rel="noopener noreferrer">source<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="generategrid-options"><a href="#generategrid-options" class="header-anchor">#</a> generateGrid(options)</h3> <p>Generate geographic grid parameters from an input location (grid center), area width and resolution. Required input hook data are the following:</p> <ul><li><strong>longitude</strong>: grid center longitude (in degrees)</li> <li><strong>latitude</strong>: grid center latitude (in degrees)</li> <li><strong>resolution</strong>: grid cell resolution (in meters)</li> <li><strong>halfWidth</strong>: grid half-width (in meters)</li> <li><strong>blockResolution</strong>: grid block resolution (in meters)</li></ul> <p>Output hook data are the following:</p> <ul><li><strong>origin</strong>: grid bounding box minimum longitude and latitude (in degrees)</li> <li><strong>size</strong>: number of grid cells in longitude and latitude</li> <li><strong>resolution</strong>: grid cell resolution (in degrees) for longitude and latitude</li> <li><strong>nbBlocks</strong>: number of grid blocks in longitude and latitude</li> <li><strong>blockSize</strong>: number of grid cells in longitude and latitude within each block</li> <li><strong>blockResolution</strong>: grid block resolution (in degrees) for longitude and latitude</li></ul> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>This hook works only for EPSG 4326</p></div> <h3 id="generategridtasks-options"><a href="#generategridtasks-options" class="header-anchor">#</a> generateGridTasks(options)</h3> <p>Generate WMS/WCS request tasks to download data for each cell of a geographic grid (see previous hook for grid definition). It is intended to be used a a job hook and the required input data on the task template are the following:</p> <ul><li><strong>type</strong>: task type (either <code>wms</code>or <code>wcs</code>)</li> <li><strong>options.version</strong>: WMS/WCS service version</li> <li><strong>options.longitudeLabel</strong>: name of the longitude axis in WCS service</li> <li><strong>options.latitudeLabel</strong>: name of the latitude axis in WCS service</li></ul> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>This hook works only for EPSG 4326</p></div> <h3 id="resamplegrid-options"><a href="#resamplegrid-options" class="header-anchor">#</a> resampleGrid(options)</h3> <p>A lot of geographical data (e.g. weather data) are distributed as gridded data, which is two-dimensional data representing an element value along an evenly spaced matrix of geographical positions. Usually, the grid has a longitude (x-axis or width) and a latitude (y-axis or height) dimension and is computed using the <a href="https://en.wikipedia.org/wiki/Equirectangular_projection" target="_blank" rel="noopener noreferrer">Equirectangular projection<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> with a constant spacing called the resolution of the grid. The gridded data is assumed to be internally stored as a Javascript array (1D).</p> <p>You can use this hook to compute element value at any location from input gridded data (a process called interpolation) with the following options:</p> <ul><li><strong>input</strong>: input grid specification
<ul><li><strong>bounds</strong>: the geographical bounds covered by the input grid as an array of decimal values <code>[min longitude, min latitude, max longitude, max latitude]</code>,</li> <li><strong>origin</strong>: the geographical origin of the input data grid as an array of decimal values <code>[longitude origin, latitude origin]</code>,</li> <li><strong>size</strong>: the size of the input data grid as an array of integer values <code>[width, height]</code>,</li> <li><strong>resolution</strong> : the geographical resolution of the input data grid as an array of decimal values <code>[longitude resolution, latitude resolution]</code></li></ul></li> <li><strong>output</strong>: output/resampled grid specification
<ul><li><strong>origin</strong>: the geographical origin of the data grid as an array of decimal values <code>[longitude origin, latitude origin]</code>,</li> <li><strong>size</strong>: the size of the data grid as an array of integer values <code>[width, height]</code>,</li> <li><strong>resolution</strong>: the geographical resolution of the data grid as an array of decimal values <code>[longitude resolution, latitude resolution]</code></li></ul></li></ul> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>The values of the element are assumed to be the one measured at the grid vertices</p></div> <h2 id="json"><a href="#json" class="header-anchor">#</a> JSON</h2> <p><a href="https://github.com/kalisio/krawler/blob/master/src/hooks/hooks.json.js" target="_blank" rel="noopener noreferrer">source<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="readjson-options"><a href="#readjson-options" class="header-anchor">#</a> readJson(options)</h3> <p>Read a JSON from an input stream/store and convert it to in-memory JSON values, hook options are the following:</p> <ul><li><strong>objectPath</strong>: property path where to read the JSON object in the JSON coming from the store, not defined by default so that the whole JSON is retrieved</li> <li><strong>dataPath</strong>: property path where to store the resulting JSON object on the hook object, defaults to <code>result.data</code></li> <li><strong>storePath</strong>: see description in <a href="/krawler/reference/hooks.html#common-options">common options</a></li> <li><strong>store</strong>: see description in <a href="/krawler/reference/hooks.html#common-options">common options</a></li> <li><strong>key</strong>: see description in <a href="/krawler/reference/hooks.html#common-options">common options</a></li> <li><strong>transform</strong>: perform transformation using these options after read, see description in <a href="/krawler/reference/hooks.html#transformjson-options">transformJson</a></li> <li><strong>features</strong>: this boolean indicates if only the features are extracted when reading a GeoJson collection, defaults to <code>false</code></li></ul> <h3 id="writejson-options"><a href="#writejson-options" class="header-anchor">#</a> writeJson(options)</h3> <p>Generate a JSON file from in-memory JSON values, hook options are the following:</p> <ul><li><strong>dataPath</strong>: property path where to read the input JSON object on the hook object, defaults to <code>result</code></li> <li><strong>storePath</strong>: see description in <a href="/krawler/reference/hooks.html#common-options">common options</a></li> <li><strong>store</strong>: see description in <a href="/krawler/reference/hooks.html#common-options">common options</a></li> <li><strong>key</strong>: see description in <a href="/krawler/reference/hooks.html#common-options">common options</a></li> <li><strong>outputType</strong>: the type of output produced by this hook, defaults to <code>intermediate</code></li> <li><strong>transform</strong>: perform transformation using these options before write, see description in <a href="/krawler/reference/hooks.html#transformjson-options">transformJson</a></li></ul> <h3 id="transformjson-options"><a href="#transformjson-options" class="header-anchor">#</a> transformJson(options)</h3> <p>Restructure in-memory JSON values, hook options are the following:</p> <ul><li><strong>dataPath</strong>: property path where to read the input JSON object on the hook object, defaults to <code>result.data</code></li> <li><strong>transformPath</strong>: property path where to read/write the JSON part to be transformed in the input JSON object</li> <li><strong>inputPath</strong>: property path where to read the JSON part to be transformed in the input JSON object</li> <li><strong>outputPath</strong>: property path where to write the JSON part to be transformed in the input JSON object</li> <li><strong>toArray</strong>: boolean indicating if the JSON object will be transformed into an array using <a href="https://lodash.com/docs#toArray" target="_blank" rel="noopener noreferrer">Lodash<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, defaults to <code>false</code></li> <li><strong>toObjects</strong>: if your input JSON objects are flat arrays it will be transformed into objects according to the given indexed list of property names to be used as keys, not defined by default</li> <li><strong>filter</strong>: a filter to be applied on the JSON object using any option supported by <a href="https://github.com/crcn/sift.js" target="_blank" rel="noopener noreferrer">sift<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><strong>mapping</strong>: a map between input key path and output key path supporting dot notation, the values of the map can also be a structure like this:
<ul><li><strong>path</strong>: output key path</li> <li><strong>value</strong>: a map between input values and output values</li> <li><strong>delete</strong>: boolean indicating if the input key path should be deleted or not after mapping</li></ul></li> <li><strong>unitMapping</strong>: a map between input key path supporting dot notation and from/to units to convert using <a href="http://mathjs.org/docs/datatypes/units.html" target="_blank" rel="noopener noreferrer">math.js<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for numbers or <a href="https://momentjs.com/" target="_blank" rel="noopener noreferrer">moment.js<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for dates, a value of the map is a structure like this:
<ul><li><strong>from</strong>: the unit or date format to convert from, e.g. <code>feet</code> or <code>YYYY-MM-DD HH:mm:ss.SSS</code></li> <li><strong>to</strong>: the unit or date format to convert to, e.g. <code>m</code> or <code>MM-DD-YYYY HH:mm:ss.SSS</code>, if given for a date the date object will be converted back to string</li> <li><strong>asDate</strong>: mandatory to indicate if the value is a date, could be <code>utc</code> or <code>local</code> to interpret it as UTC or Local Time</li> <li><strong>asString</strong>: mandatory to convert numbers to strings, indicates the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/toString#Syntax" target="_blank" rel="noopener noreferrer">radix<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to be used</li> <li><strong>asNumber</strong>: mandatory to convert strings to numbers</li> <li><strong>empty</strong>: value to be set if the input value is empty</li></ul></li> <li><strong>pick</strong>: an array of properties to be picked using <a href="https://lodash.com/docs#pick" target="_blank" rel="noopener noreferrer">Lodash<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><strong>omit</strong>: an array of properties to be omitted using <a href="https://lodash.com/docs#omit" target="_blank" rel="noopener noreferrer">Lodash<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><strong>merge</strong>: an object to be merged with each JSON objects using <a href="https://lodash.com/docs#merge" target="_blank" rel="noopener noreferrer">Lodash<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><strong>asObject</strong>: this boolean indicates if the output should be transformed into an object if the array contains a single object, defaults to <code>false</code></li> <li><strong>asArray</strong>: this boolean indicates if the output should be transformed into an array containing the object, defaults to <code>false</code></li> <li><strong>inPlace</strong>: this boolean indicates if the input data is transformed in place or simply before writing it when part of a write hook, defaults to <code>true</code></li></ul> <p>Example:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">toArray</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// The following input object { 1: { property: 'a' }, 2: { property: 'b' } } will be transformed into [{ property: 'a' }, { property: 'b' }]</span>
<span class="token literal-property property">toObjects</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// The following input object ['a', 'b'] will be transformed into { 1: 'a', 2: 'b' }</span>
<span class="token literal-property property">mapping</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">sourceProperty</span><span class="token operator">:</span> <span class="token string">'targetProperty'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">sourceProperty</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'targetProperty'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">values</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">'a'</span><span class="token operator">:</span> <span class="token string">'c'</span> <span class="token comment">// Will map { xxx: 'a' } to { yyy: 'c' }</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">'source.property'</span><span class="token operator">:</span> <span class="token string">'target.property'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">sourceProperty</span><span class="token operator">:</span> <span class="token string">'targetArrayProperty[0]'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token literal-property property">unitMapping</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">property</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">from</span><span class="token operator">:</span> <span class="token string">'feet'</span><span class="token punctuation">,</span> <span class="token literal-property property">to</span><span class="token operator">:</span> <span class="token string">'m'</span> <span class="token punctuation">}</span> <span class="token comment">// This one will be converted from feet to meters</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token literal-property property">pick</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'onlyThisPropertyWillBeKept'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token literal-property property">omit</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'onlyThisPropertyWillBeRemoved'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token literal-property property">merge</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">newProperty</span><span class="token operator">:</span> <span class="token string">'will be added to the final objects'</span> <span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>The transformations are applied in the order of the documentation, e.g. filtering occurs before mapping.</p></div> <h3 id="mergejson-options"><a href="#mergejson-options" class="header-anchor">#</a> mergeJson(options)</h3> <p>Generate a in-memory JSON object from a set of input in-memory JSON objects, hook options are the following:</p> <ul><li><strong>mergeBy</strong>: property name to be used as a unique identifier to perform merging using <a href="https://lodash.com/docs#unionBy" target="_blank" rel="noopener noreferrer">Lodash<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, it can also be a function returning a unique identifier</li> <li><strong>deep</strong>: this boolean indicates if properties from multiple objects with the same identifier are merged, otherwise only the first object matching the merge condition will be kept, defaults to <code>false</code></li> <li><strong>sortBy</strong>: property name to be used as value for sorting items prior merging using <a href="https://lodash.com/docs#sortBy" target="_blank" rel="noopener noreferrer">Lodash<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, it can also be a function returning a unique identifier</li> <li><strong>transform</strong>: perform transformation using these options before deep merging objects with the same identifier, see description in <a href="/krawler/reference/hooks.html#transformjson-options">transformJson</a></li> <li><strong>dataPath</strong>: property path where to read the input JSON object on the result hook objects, defaults to <code>data</code></li></ul> <p>The input hook result is expected to be an array of tasks which output will be read in-memory.</p> <h3 id="writetemplate-options"><a href="#writetemplate-options" class="header-anchor">#</a> writeTemplate(options)</h3> <p>Generate a file from an input template and injected in-memory JSON values, hook options are the following:</p> <ul><li><strong>dataPath</strong>: property path where to read the input JSON object on the hook object, defaults to <code>result.data</code></li> <li><strong>storePath</strong>: see description in <a href="/krawler/reference/hooks.html#common-options">common options</a></li> <li><strong>store</strong>: see description in <a href="/krawler/reference/hooks.html#common-options">common options</a></li> <li><strong>templateStorePath</strong>: property path where to read the store to be used for reading template on the hook object or params, defaults to <code>data.templateStore</code></li> <li><strong>templateStore</strong>: property containing the ID of the store to be used for reading template, not defined by default</li> <li><strong>templateFile</strong>: file name of the template file to be used</li> <li><strong>outputType</strong>: the type of output produced by this hook, defaults to <code>intermediate</code></li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Learn more about <a href="https://lodash.com/docs/4.17.4#template" target="_blank" rel="noopener noreferrer">templating<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <h2 id="geojson"><a href="#geojson" class="header-anchor">#</a> GeoJSON</h2> <p><a href="https://github.com/kalisio/krawler/blob/master/src/hooks/hooks.geojson.js" target="_blank" rel="noopener noreferrer">source<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="converttogeojson-options"><a href="#converttogeojson-options" class="header-anchor">#</a> convertToGeoJson(options)</h3> <p>Convert in-memory JSON values to a <a href="https://fr.wikipedia.org/wiki/GeoJSON" target="_blank" rel="noopener noreferrer">GeoJSON<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> collection. For each in-memory object, the hook generates a corresponding GeoJSON feature using specific properties to build the <code>geometry</code> property. For now, it only allows to generate features of type of <code>Point</code>. Moreover, the coordinate reference system is a geographic coordinate reference system, using the World Geodetic System 1984 (WGS 84), with longitude and latitude expressed in decimal degrees. The entire object is stored under the <code>properties</code> property of the feature.
Hook options are the following:</p> <ul><li><strong>longitude</strong>: property path where to read the longitude value defaults to <code>longitude</code></li> <li><strong>latitude</strong>: property path where to read the latitude value defaults to <code>latitude</code></li> <li><strong>altitude</strong>: property path where to read the altitude value defaults to <code>altitude</code></li> <li><strong>keepGeometryProperties</strong>: boolean indicating if longitude, latitude and altitude values are also kept as properties, defaults to <code>true</code></li></ul> <h3 id="convertosmtogeojson-options"><a href="#convertosmtogeojson-options" class="header-anchor">#</a> convertOSMToGeoJson(options)</h3> <p>Convert in-memory OSM JSON values to a <a href="https://fr.wikipedia.org/wiki/GeoJSON" target="_blank" rel="noopener noreferrer">GeoJSON<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> collection. It relies on <a href="https://github.com/tyrasd/osmtogeojson" target="_blank" rel="noopener noreferrer">osmtogeojson<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Hook options are the following:</p> <ul><li>any option supported by the <a href="https://github.com/tyrasd/osmtogeojson#api" target="_blank" rel="noopener noreferrer">osmtogeojson<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> API</li> <li><strong>dataPath</strong>: property path where to read the OSM object, defaults to <code>result.data</code></li></ul> <h3 id="reprojectgeojson-options"><a href="#reprojectgeojson-options" class="header-anchor">#</a> reprojectGeoJson(options)</h3> <p>Reproject a GeoJSON from a given projection system to another one, hook options are the following:</p> <ul><li><strong>from</strong>: EPSG code of the input projection, defaults to <code>EPSG:4326</code></li> <li><strong>to</strong>: EPSG code of the output projection, defaults to <code>EPSG:4326</code></li> <li><strong>dataPath</strong>: property path where to store the resulting GeoJSON object on the hook object, defaults to <code>result.data</code></li></ul> <h2 id="kml"><a href="#kml" class="header-anchor">#</a> KML</h2> <p><a href="https://github.com/kalisio/krawler/blob/master/src/hooks/hooks.kml.js" target="_blank" rel="noopener noreferrer">source<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="readkml-options"><a href="#readkml-options" class="header-anchor">#</a> readKML(options)</h3> <p>Read a KML from an input stream/store and convert it to in-memory JSON values, hook options are the following:</p> <ul><li><strong>objectPath</strong>: property path where to read the KML object in the KML coming from the store, not defined by default so that the whole KML is retrieved</li> <li><strong>dataPath</strong>: property path where to store the resulting JSON object on the hook object, defaults to <code>result.data</code></li> <li><strong>storePath</strong>: see description in <a href="/krawler/reference/hooks.html#common-options">common options</a></li> <li><strong>store</strong>: see description in <a href="/krawler/reference/hooks.html#common-options">common options</a></li> <li><strong>key</strong>: see description in <a href="/krawler/reference/hooks.html#common-options">common options</a></li> <li><strong>transform</strong>: perform transformation using these options after read, see description in <a href="/krawler/reference/hooks.html#transformjson-options">transformJson</a></li> <li><strong>features</strong>: this boolean indicates if only the features are extracted when reading a GeoJson collection, defaults to <code>false</code></li></ul> <h2 id="mongodb"><a href="#mongodb" class="header-anchor">#</a> MongoDB</h2> <p><a href="https://github.com/kalisio/krawler/blob/master/src/hooks/hooks.mongo.js" target="_blank" rel="noopener noreferrer">source<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="connectmongo-options"><a href="#connectmongo-options" class="header-anchor">#</a> connectMongo(options)</h3> <p>Connect to a MongoDB database. The <a href="http://mongodb.github.io/node-mongodb-native/3.0/api/MongoClient.html#.connect" target="_blank" rel="noopener noreferrer">connection options<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> of the client are defined in the hook options plus:</p> <ul><li><strong>url</strong>: MongoDB <a href="https://docs.mongodb.com/manual/reference/connection-string/" target="_blank" rel="noopener noreferrer">URI connection string<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><strong>dbName</strong>: the name of the DB to connect to</li> <li><strong>clientPath</strong>: property path where to store the client object to be used by the MongoDB hooks, defaults to <code>client</code></li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Since <strong>Krawler</strong> relies on the version 3.1.13 of the MongoDB driver, it automatically adds the option <code>useNewUrlParser: true</code> when connecting to the database.</p></div> <h3 id="disconnectmongo-options"><a href="#disconnectmongo-options" class="header-anchor">#</a> disconnectMongo(options)</h3> <p>Disconnect from a MongoDB database. Hook options are the following:</p> <ul><li><strong>clientPath</strong>: property path where to retrieve the client object, defaults to <code>client</code></li></ul> <h3 id="dropmongocollection-options"><a href="#dropmongocollection-options" class="header-anchor">#</a> dropMongoCollection(options)</h3> <p>Drop if exists a collection in a MongoDB database. Hook options are the following:</p> <ul><li><strong>collection</strong>: the name of the collection to be removed, defaults to the hook object ID</li> <li><strong>clientPath</strong>: property path where to retrieve the client object, defaults to <code>client</code></li></ul> <h3 id="createmongocollection-options"><a href="#createmongocollection-options" class="header-anchor">#</a> createMongoCollection(options)</h3> <p>Create a collection in a MongoDB database. Hook options are the following:</p> <ul><li><strong>collection</strong>: the name of the collection to be created, defaults to the hook object ID</li> <li><strong>index</strong>: the <a href="https://docs.mongodb.com/manual/indexes/#create-an-index" target="_blank" rel="noopener noreferrer">specification of the index<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> associated to the collection</li> <li><strong>clientPath</strong>: property path where to retrieve the client object, defaults to <code>client</code></li></ul> <h3 id="readmongocollection-options"><a href="#readmongocollection-options" class="header-anchor">#</a> readMongoCollection(options)</h3> <p>Read JSON documents from an existing collection. Hook options are the following:</p> <ul><li><strong>collection</strong>: the name of the collection to be read, defaults to the hook object ID</li> <li><strong>dataPath</strong>: property path where to write the output JSON objects on the hook object, defaults to <code>data.result</code></li> <li><strong>clientPath</strong>: property path where to retrieve the client object, defaults to <code>client</code></li> <li><strong>transform</strong>: perform transformation using these options after read, see description in <a href="/krawler/reference/hooks.html#transformjson-options">transformJson</a></li> <li><strong>query</strong>: <a href="http://mongodb.github.io/node-mongodb-native/3.1/api/Collection.html#find" target="_blank" rel="noopener noreferrer">find query<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to be performed, fields can be templates, learn more about <a href="https://lodash.com/docs/4.17.4#template" target="_blank" rel="noopener noreferrer">templating<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><strong>project</strong>: project options for <a href="http://mongodb.github.io/node-mongodb-native/3.1/api/Cursor.html" target="_blank" rel="noopener noreferrer">cursor<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><strong>sort</strong>: sort options for <a href="http://mongodb.github.io/node-mongodb-native/3.1/api/Cursor.html" target="_blank" rel="noopener noreferrer">cursor<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><strong>skip</strong>: skip options for <a href="http://mongodb.github.io/node-mongodb-native/3.1/api/Cursor.html" target="_blank" rel="noopener noreferrer">cursor<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><strong>limit</strong>: limit options for <a href="http://mongodb.github.io/node-mongodb-native/3.1/api/Cursor.html" target="_blank" rel="noopener noreferrer">cursor<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Due to templating restricted to string output any ISO date string or comparison operator value in the query object will be converted back to native types so that matching will work as expected in JS</p></div> <h3 id="writemongocollection-options"><a href="#writemongocollection-options" class="header-anchor">#</a> writeMongoCollection(options)</h3> <p>Inserts JSON into an existing collection (uses <a href="https://docs.mongodb.com/manual/reference/method/db.collection.bulkWrite/#insertone" target="_blank" rel="noopener noreferrer">insertOne<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> operations under-the-hood). Hook options are the following:</p> <ul><li><strong>collection</strong>: the name of the collection to be written, defaults to the hook object ID</li> <li><strong>dataPath</strong>: property path where to read the input JSON object on the hook object, defaults to <code>data.result</code></li> <li><strong>chunkSize</strong>: number of GeoJson features for the <a href="https://docs.mongodb.com/manual/reference/method/db.collection.bulkWrite/" target="_blank" rel="noopener noreferrer">batch insert<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><strong>clientPath</strong>: property path where to retrieve the client object, defaults to <code>client</code></li> <li><strong>transform</strong>: perform transformation using these options before write, see description in <a href="/krawler/reference/hooks.html#transformjson-options">transformJson</a></li> <li>any option supported by <code>options</code> argument of the <a href="https://docs.mongodb.com/manual/reference/method/db.collection.bulkWrite/" target="_blank" rel="noopener noreferrer">bulkWrite<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> function.</li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>If the input data is a GeoJSON collection the array of features will be pushed into the collection not the root object, this is to conform with MongoDB geospatial capabilities that can not handle recursive collections.</p></div> <h3 id="updatemongocollection-options"><a href="#updatemongocollection-options" class="header-anchor">#</a> updateMongoCollection(options)</h3> <p>Updates JSON into an existing collection (uses <a href="https://docs.mongodb.com/manual/reference/method/db.collection.bulkWrite/#updateone-and-updatemany" target="_blank" rel="noopener noreferrer">updateOne<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> operations under-the-hood). Hook options are the following:</p> <ul><li><strong>collection</strong>: the name of the collection to be written, defaults to the hook object ID</li> <li><strong>dataPath</strong>: property path where to read the input JSON object on the hook object, defaults to <code>data.result</code></li> <li><strong>chunkSize</strong>: number of GeoJson features for the <a href="https://docs.mongodb.com/manual/reference/method/db.collection.bulkWrite/" target="_blank" rel="noopener noreferrer">batch insert<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><strong>clientPath</strong>: property path where to retrieve the client object, defaults to <code>client</code></li> <li><strong>transform</strong>: perform transformation using these options before update, see description in <a href="/krawler/reference/hooks.html#transformjson-options">transformJson</a></li> <li><strong>filter/upsert/hint</strong>: corresponding option for <code>updateOne</code> operation</li> <li>any option supported by <code>options</code> argument of the <a href="https://docs.mongodb.com/manual/reference/method/db.collection.bulkWrite/" target="_blank" rel="noopener noreferrer">bulkWrite<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> function.</li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>If the input data is a GeoJSON collection the array of features will be updated into the collection not the root object, this is to conform with MongoDB geospatial capabilities that can not handle recursive collections.</p></div> <h3 id="deletemongocollection-options"><a href="#deletemongocollection-options" class="header-anchor">#</a> deleteMongoCollection(options)</h3> <p>Removes documents from an existing collection (uses <a href="https://www.mongodb.com/docs/manual/reference/method/db.collection.deleteMany/" target="_blank" rel="noopener noreferrer">deleteMany<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> operations under-the-hood). Hook options are the following:</p> <ul><li><strong>collection</strong>: the name of the collection to remove documents from, defaults to the hook object ID</li> <li><strong>filter</strong>: deletion criteria for <code>deleteMany</code> operation</li></ul> <h3 id="createmongoaggregation-options"><a href="#createmongoaggregation-options" class="header-anchor">#</a> createMongoAggregation(options)</h3> <p>Creates an <a href="https://docs.mongodb.com/manual/aggregation/#aggregation-framework" target="_blank" rel="noopener noreferrer">aggregation pipeline<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> on an existing collection. Hook options are the following:</p> <ul><li><strong>collection</strong>: the name of the collection to used, defaults to the hook object ID</li> <li><strong>dataPath</strong>: property path where to store the result of the aggregation, defaults to <code>data.result</code></li> <li><strong>clientPath</strong>: property path where to retrieve the client object, defaults to <code>client</code></li> <li><strong>transform</strong>: perform transformation using these options before write, see description in <a href="/krawler/reference/hooks.html#transformjson-options">transformJson</a></li> <li>any option supported by <code>options</code> argument of the <a href="https://docs.mongodb.com/manual/reference/method/db.collection.aggregate/" target="_blank" rel="noopener noreferrer">aggregate<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> function.</li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>If the input data is a GeoJSON collection the array of features will be pushed into the collection not the root object, this is to conform with MongoDB geospatial capabilities that can not handle recursive collections.</p></div> <h3 id="dropmongobucket-options"><a href="#dropmongobucket-options" class="header-anchor">#</a> dropMongoBucket(options)</h3> <p>Drop if exists a bucket in a MongoDB database. Hook options are the following:</p> <ul><li><strong>bucket</strong>: the name of the bucket to be removed, defaults to the hook object ID</li> <li><strong>clientPath</strong>: property path where to retrieve the client object, defaults to <code>client</code></li></ul> <h3 id="createmongobucket-options"><a href="#createmongobucket-options" class="header-anchor">#</a> createMongoBucket(options)</h3> <p>Create a bucket in a MongoDB database. Hook options are the following:</p> <ul><li><strong>bucket</strong>: the name of the bucket to be created, defaults to the hook object ID</li> <li><strong>clientPath</strong>: property path where to retrieve the client object, defaults to <code>client</code></li></ul> <h3 id="readmongobucket-options"><a href="#readmongobucket-options" class="header-anchor">#</a> readMongoBucket(options)</h3> <p>Read file from an existing bucket. Hook options are the following:</p> <ul><li><strong>bucket</strong>: the name of the bucket to be read, defaults to the hook object ID</li> <li><strong>storePath</strong>: see description in <a href="/krawler/reference/hooks.html#common-options">common options</a>, specify store to write file to</li> <li><strong>store</strong>: see description in <a href="/krawler/reference/hooks.html#common-options">common options</a>, specify store to write file to</li> <li><strong>key</strong>: see description in <a href="/krawler/reference/hooks.html#common-options">common options</a>, defaults to the hook object ID</li></ul> <h3 id="writemongobucket-options"><a href="#writemongobucket-options" class="header-anchor">#</a> writeMongoBucket(options)</h3> <p>Insert file into an existing bucket. Hook options are the following:</p> <ul><li><strong>bucket</strong>: the name of the bucket to be written, defaults to the hook object ID</li> <li><strong>storePath</strong>: see description in <a href="/krawler/reference/hooks.html#common-options">common options</a>, specify store to read file from</li> <li><strong>store</strong>: see description in <a href="/krawler/reference/hooks.html#common-options">common options</a>, specify store to read file from</li> <li><strong>key</strong>: see description in <a href="/krawler/reference/hooks.html#common-options">common options</a>, defaults to the hook object ID</li></ul> <blockquote><p>If the input data is a GeoJSON collection the array of features will be pushed into the collection not the root object, this is to conform with MongoDB geospatial capabilities that can not handle recursive collections</p></blockquote> <h2 id="feathers"><a href="#feathers" class="header-anchor">#</a> Feathers</h2> <p><a href="https://github.com/kalisio/krawler/blob/master/src/hooks/hooks.feathers.js" target="_blank" rel="noopener noreferrer">source<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="connectfeathers-options"><a href="#connectfeathers-options" class="header-anchor">#</a> connectFeathers(options)</h3> <p>Connect to a Feathers API. The <a href="https://docs.feathersjs.com/api/client.html" target="_blank" rel="noopener noreferrer">connection options<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> of the client are defined in the hook options plus:</p> <ul><li><strong>distributed</strong>: Boolean indicating if the target service is retrieved using distribution (you will need to set the <code>distribution</code> job options and CLI <code>api</code> option), in this case you don't need the others properties</li> <li><strong>origin</strong>: Feathers connection URL</li> <li><strong>path</strong>: the Feathers API path prefix if any</li> <li><strong>authentication</strong>: the Feathers API authentication options if any (including service <code>path</code>)</li> <li><strong>clientPath</strong>: property path where to store the client object to be used by the Feathers hooks, defaults to <code>client</code></li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><strong>Krawler</strong> uses on the version 5 of the Feathers client.</p></div> <h3 id="disconnectfeathers-options"><a href="#disconnectfeathers-options" class="header-anchor">#</a> disconnectFeathers(options)</h3> <p>Disconnect from a Feathers API. Hook options are the following:</p> <ul><li><strong>clientPath</strong>: property path where to retrieve the client object, defaults to <code>client</code></li></ul> <h3 id="callfeathersservicemethod-options"><a href="#callfeathersservicemethod-options" class="header-anchor">#</a> callFeathersServiceMethod(options)</h3> <p>Performs a service operation using the API. Hook options are the following:</p> <ul><li><strong>service</strong>: the name of the service to be used, defaults to the hook object ID</li> <li><strong>method</strong>: the name of the method to be called, defaults to <code>find</code></li> <li><strong>id</strong>: the ID of the item to read/write, defaults to item ID</li> <li><strong>data</strong>: the data payload of the operation, if not given will be hook item data</li> <li><strong>dataPath</strong>: property path where to read/write the input/output JSON objects on the hook object, defaults to <code>data.result</code></li> <li><strong>chunkSize</strong>: number of item for a <a href="https://docs.feathersjs.com/api/databases/common.html#options" target="_blank" rel="noopener noreferrer">multi operation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><strong>clientPath</strong>: property path where to retrieve the client object, defaults to <code>client</code></li> <li><strong>transform</strong>: perform transformation using these options after/before read/write, see description in <a href="/krawler/reference/hooks.html#transformjson-options">transformJson</a></li> <li><strong>query</strong>: <a href="https://docs.feathersjs.com/api/databases/querying.html" target="_blank" rel="noopener noreferrer">operation query<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to be performed (use only if not giving the whole <strong>params</strong> object), fields can be templates, learn more about <a href="https://lodash.com/docs/4.17.4#template" target="_blank" rel="noopener noreferrer">templating<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><strong>params</strong>: <a href="https://docs.feathersjs.com/api/services.html#params" target="_blank" rel="noopener noreferrer">operation params<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to be used, fields can be templates, learn more about <a href="https://lodash.com/docs/4.17.4#template" target="_blank" rel="noopener noreferrer">templating<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><strong>updateResult</strong>: if <code>true</code> service operation results will not replace item data (default for read operations)</li></ul> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Due to templating restricted to string output any ISO date string or comparison operator value in the query object will be converted back to native types so that matching will work as expected in JS</p></div> <h3 id="writemongocollection-options-2"><a href="#writemongocollection-options-2" class="header-anchor">#</a> writeMongoCollection(options)</h3> <p>Inserts JSON into an existing collection (uses <a href="https://docs.mongodb.com/manual/reference/method/db.collection.bulkWrite/#insertone" target="_blank" rel="noopener noreferrer">insertOne<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> operations under-the-hood). Hook options are the following:</p> <ul><li><strong>collection</strong>: the name of the collection to be written, defaults to the hook object ID</li> <li><strong>dataPath</strong>: property path where to read the input JSON object on the hook object, defaults to <code>data.result</code></li> <li><strong>chunkSize</strong>: number of GeoJson features for the <a href="https://docs.mongodb.com/manual/reference/method/db.collection.bulkWrite/" target="_blank" rel="noopener noreferrer">batch insert<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><strong>clientPath</strong>: property path where to retrieve the client object, defaults to <code>client</code></li> <li><strong>transform</strong>: perform transformation using these options before write, see description in <a href="/krawler/reference/hooks.html#transformjson-options">transformJson</a></li> <li>any option supported by <code>options</code> argument of the <a href="https://docs.mongodb.com/manual/reference/method/db.collection.bulkWrite/" target="_blank" rel="noopener noreferrer">bulkWrite<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> function.</li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>If the input data is a GeoJSON collection the array of features will be pushed into the collection not the root object, this is to conform with MongoDB geospatial capabilities that can not handle recursive collections.</p></div> <h2 id="numerical-weather-prediction"><a href="#numerical-weather-prediction" class="header-anchor">#</a> Numerical Weather Prediction</h2> <p><a href="https://github.com/kalisio/krawler/blob/master/src/hooks/hooks.nwp.js" target="_blank" rel="noopener noreferrer">source<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Numerical Weather Prediction (NWP) data are now available from the major meteorological agencies and institutions on a day-to-day basis. These hooks aim at gathering weather forecast data generated by forecast models easily.</p> <p>Each forecast model output hundreds of forecast elements (a.k.a. <em>meteorological elements</em>) such as temperature, wind direction, etc. The production of a set of forecast data is called a <em>run</em> of the model and occurs on a regular daily basis, e.g. every 6 hours. The spatial properties of a model are completely defined by a longitude/latitude grid and a set of altitude <em>levels</em> (meter or pressure scale). The temporal properties are defined by interval values describing at which frequency/time the forecast data are produced (a.k.a. <em>run interval</em>) and which time steps are available (a.k.a. <em>forecast interval</em>).</p> <h3 id="generatenwptasks-options"><a href="#generatenwptasks-options" class="header-anchor">#</a> generateNwpTasks(options)</h3> <p>Generate tasks to download data for each variable. It is intended to be used a job hook and the required hook options (can be overriden by input data) are the following:</p> <ul><li><strong>elements</strong>: the array of meteorological elements to be retrieved</li> <li><strong>runInterval</strong>: the run interval in seconds</li> <li><strong>runIndex</strong>: the index of the run to be retrieved, 0 means nearest from current time, -1 the previous one, etc.</li> <li><strong>interval</strong>: the forecast interval in seconds</li> <li><strong>lowerLimit</strong>: the lowest offset in seconds from which forecast data are retrieved (e.g. 3600 means we start gathering at T0 + 1h)</li> <li><strong>upperLimit</strong>: the highest offset in seconds at which forecast data are not retrieved (e.g. 10800 means we stop gathering at T0 + 3h)</li></ul> <p>A task will be generated for each element, level and gathered forecast time with the following properties: <strong>level</strong>, <strong>runTime</strong>, <strong>forecastTime</strong>, <strong>timeOffset</strong>.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>This hook is intended to work with task templating to generate the actual download tasks (e.g. HTTP or WCS request)</p></div> <h2 id="ogc"><a href="#ogc" class="header-anchor">#</a> OGC</h2> <p><a href="https://github.com/kalisio/krawler/blob/master/src/hooks/hooks.ogc.js" target="_blank" rel="noopener noreferrer">source<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="getcapabilities-options"><a href="#getcapabilities-options" class="header-anchor">#</a> getCapabilities(options)</h3> <p>Execute a <code>GetCapabilties</code> request to get the general information about an OGC service such as WMS, WCS, WPS...
Hook options are the following:</p> <ul><li><strong>url</strong>: the bas url of the request to be executed</li> <li><strong>service</strong>: the service to request</li> <li><strong>token</strong>: an access token if required by the server</li> <li><strong>dataPath</strong>: property path where to store the resulting JSON object on the hook object, defaults to <code>result.data</code></li></ul> <p>The following example illustrates how to use this hook:</p> <div class="language- extra-class"><pre class="language-text"><code>getCapabilities: {
  url: 'http://geoserver.kalisio.xyz/geoserver/Kalisio/wms',
  service: 'WMS'
}
</code></pre></div><h2 id="postgresql"><a href="#postgresql" class="header-anchor">#</a> PostgreSQL</h2> <p><a href="https://github.com/kalisio/krawler/blob/master/src/hooks/hooks.pg.js" target="_blank" rel="noopener noreferrer">source<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="connectpg-options"><a href="#connectpg-options" class="header-anchor">#</a> connectPG(options)</h3> <p>Connect to a PostgreSQL database. The <a href="https://node-postgres.com/api/client" target="_blank" rel="noopener noreferrer">connection options<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> of the client are defined in the hook options plus:</p> <ul><li><strong>clientPath</strong>: property path where to store the client object to be used by the PostgreSQL hooks, defaults to <code>client</code></li></ul> <p>Also, this hook allows you to use the same environment variables as <a href="https://node-postgres.com/features/connecting" target="_blank" rel="noopener noreferrer">node-postgres<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to store the connection information:</p> <ul><li><code>PGUSER=dbuser</code></li> <li><code>PGPASSWORD=secretpassword</code></li> <li><code>PGHOST=database.server.com</code></li> <li><code>PGPORT=5432</code></li> <li><code>PGDATABASE=database</code></li></ul> <p>Finaly and for some security reason, it is highly recommended to combine both ways such as in the following example:</p> <div class="language- extra-class"><pre class="language-text"><code>connectPG: {
  user: process.env.PG_USER,
  password: process.env.PG_PASSWORD,
  host: 'localhost',
  database: 'test',
  port: 5432,
  clientPath: 'taskTemplate.client'
}
</code></pre></div><h3 id="disconnectpg-options"><a href="#disconnectpg-options" class="header-anchor">#</a> disconnectPG(options)</h3> <p>Disconnect from a PostgresSQL database. Hook options are the following:</p> <ul><li><strong>clientPath</strong>: property path where to retrieve the client object, defaults to <code>client</code></li></ul> <h3 id="droppgtable-options"><a href="#droppgtable-options" class="header-anchor">#</a> dropPGTable(options)</h3> <p>Drop if exists a table in a PostgreSQL database. Hook options are the following:</p> <ul><li><strong>table</strong>: the name of the table to be removed, defaults to the hook object ID</li> <li><strong>clientPath</strong>: property path where to retrieve the client object, defaults to <code>client</code></li></ul> <h3 id="createpgtable-options"><a href="#createpgtable-options" class="header-anchor">#</a> createPGTable(options)</h3> <p>Create a table in a PostgreSQL database with the following structure:</p> <ul><li><code>id</code>: a SERIAL (primary key)</li> <li><code>geom</code>: a PostGIS geometry of type of <code>POINTZ</code> expressed in Geodetic reference system.</li> <li><code>properties</code>: an object of type of JSON.</li></ul> <blockquote><p>For now the structure has been defined to store GeoJSON collection.
Hook options are the following:</p></blockquote> <ul><li><strong>table</strong>: the name of the table to be created, defaults to the hook object ID</li> <li><strong>clientPath</strong>: property path where to retrieve the client object, defaults to <code>client</code></li></ul> <h3 id="writepgtable-options"><a href="#writepgtable-options" class="header-anchor">#</a> writePGTable(options)</h3> <p>Inserts a GeoJSON collection or an array of features into an existing table. THe table must have the same structured as a table created using the <strong>createPGTable</strong> hook.
Hook options are the following:</p> <ul><li><strong>dataPath</strong>: property path where to read the input JSON object on the hook object, defaults to <code>data.result</code></li> <li><strong>chunkSize</strong>: number of GeoJson features for the batch insert</li> <li><strong>clientPath</strong>: property path where to retrieve the client object, defaults to <code>client</code></li></ul> <h2 id="raster"><a href="#raster" class="header-anchor">#</a> Raster</h2> <p><a href="https://github.com/kalisio/krawler/blob/master/src/hooks/hooks.raster.js" target="_blank" rel="noopener noreferrer">source<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="readgeotiff-options"><a href="#readgeotiff-options" class="header-anchor">#</a> readGeoTiff(options)</h3> <p>Read a GeoTiff from an input stream/store and convert it to in-memory JSON values, hook options are the following:</p> <ul><li><strong>dataPath</strong>: property path where to store the resulting JSON object on the hook object, defaults to <code>result.data</code></li> <li><strong>fields</strong>: set of fields to be exported for each cell, if empty values will be directly exported as a JSON array, otherwise fields among the following can be selected
<ul><li><strong>x</strong>: pixel x-coordinate</li> <li><strong>y</strong>: pixel y-coordinate</li> <li><strong>bbox</strong>: pixel bounding box</li> <li><strong>value</strong>: pixel value</li></ul></li></ul> <h3 id="computestatistics-options"><a href="#computestatistics-options" class="header-anchor">#</a> computeStatistics(options)</h3> <p>Computes minimum and maximum values on a GeoTiff file, hook options are the following:</p> <ul><li><strong>min</strong>: boolean indicating if minimum value should be computed</li> <li><strong>max</strong>: boolean indicating if maximum value should be computed</li> <li><strong>statisticsPath</strong>: property path where to write the output statistics on the hook object, defaults to <code>result</code></li></ul> <h2 id="store"><a href="#store" class="header-anchor">#</a> Store</h2> <p><a href="https://github.com/kalisio/krawler/blob/master/src/hooks/hooks.store.js" target="_blank" rel="noopener noreferrer">source<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="createstores-options"><a href="#createstores-options" class="header-anchor">#</a> createStores(options)</h3> <p>Create (a set of) store(s), hook options are the (array of) following the following:</p> <ul><li>any option supported by the <a href="/krawler/reference/services.html#stores">stores service</a></li> <li><strong>storePath</strong>: property path where to set the created store on the hook object, if not given the store will be created through the service but not stored on the hook</li></ul> <h3 id="removestores-options"><a href="#removestores-options" class="header-anchor">#</a> removeStores(options)</h3> <p>Remove (a set of) store(s), hook options are (array of) the following:</p> <ul><li><strong>id</strong>: the store ID</li> <li><strong>storePath</strong>: property path where to unset the removed store on the hook object, if not given the store will be removed through service but not on the hook</li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>As a shortcut the options provided can only be store IDs when <strong>storePath</strong> is not used</p></div> <h3 id="discardifexistsinstore-options"><a href="#discardifexistsinstore-options" class="header-anchor">#</a> discardIfExistsInStore(options)</h3> <p>Discard the task if a target file already exists in an output store, hook options are the following:</p> <ul><li><strong>output</strong>: the output store options, see description in <a href="/krawler/reference/hooks.html#common-options">common options</a></li></ul> <h3 id="copytostore-options"><a href="#copytostore-options" class="header-anchor">#</a> copyToStore(options)</h3> <p>Copy the item(s) from an input store to an output store, hook options are the following:</p> <ul><li><strong>input</strong>: the input store options, see description in <a href="/krawler/reference/hooks.html#common-options">common options</a></li> <li><strong>output</strong>: the output store options, see description in <a href="/krawler/reference/hooks.html#common-options">common options</a></li></ul> <h3 id="gziptostore-options"><a href="#gziptostore-options" class="header-anchor">#</a> gzipToStore(options)</h3> <p>Gzip the item(s) from an input store to an output store, hook options are the following:</p> <ul><li><strong>input</strong>: the input store options, see description in <a href="/krawler/reference/hooks.html#common-options">common options</a></li> <li><strong>output</strong>: the output store options, see description in <a href="/krawler/reference/hooks.html#common-options">common options</a></li></ul> <h3 id="gunzipfromstore-options"><a href="#gunzipfromstore-options" class="header-anchor">#</a> gunzipFromStore(options)</h3> <p>Gunzip the item(s) from an input store to an output store, hook options are the following:</p> <ul><li><strong>input</strong>: the input store options, see description in <a href="/krawler/reference/hooks.html#common-options">common options</a></li> <li><strong>output</strong>: the output store options, see description in <a href="/krawler/reference/hooks.html#common-options">common options</a></li></ul> <h3 id="unzipfromstore-options"><a href="#unzipfromstore-options" class="header-anchor">#</a> unzipFromStore(options)</h3> <p>Unzip the item(s) from an input store to an output store, hook options are the following:</p> <ul><li><strong>input</strong>: the input store options, see description in <a href="/krawler/reference/hooks.html#common-options">common options</a></li> <li><strong>output</strong>: the output store options, see description in <a href="/krawler/reference/hooks.html#common-options">common options</a> <ul><li><strong>path</strong>: the output path in output store</li></ul></li></ul> <h2 id="system"><a href="#system" class="header-anchor">#</a> System</h2> <p><a href="https://github.com/kalisio/krawler/blob/master/src/hooks/hooks.system.js" target="_blank" rel="noopener noreferrer">source<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="tar-options"><a href="#tar-options" class="header-anchor">#</a> tar(options)</h3> <p>Tar files or directories using <a href="https://github.com/npm/node-tar" target="_blank" rel="noopener noreferrer">node-tar<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, hook options are the following:</p> <ul><li><strong>files</strong>: array of paths to add to the tarball</li> <li>any option supported by node-tar for <a href="https://github.com/npm/node-tar#tarcoptions-filelist-callback-alias-tarcreate" target="_blank" rel="noopener noreferrer">packing<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>file</code>, <code>files</code> and <code>cwd</code> options can be templates, learn more about <a href="https://lodash.com/docs/4.17.4#template" target="_blank" rel="noopener noreferrer">templating<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <h3 id="untar-options"><a href="#untar-options" class="header-anchor">#</a> untar(options)</h3> <p>Untar files or directories using <a href="https://github.com/npm/node-tar" target="_blank" rel="noopener noreferrer">node-tar<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, hook options are the following:</p> <ul><li><strong>files</strong>: array of paths to extract from the tarball</li> <li>any option supported by node-tar for <a href="https://github.com/npm/node-tar#tarxoptions-filelist-callback-alias-tarextract" target="_blank" rel="noopener noreferrer">unpacking<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>file</code>, <code>files</code> and <code>cwd</code> options can be templates, learn more about <a href="https://lodash.com/docs/4.17.4#template" target="_blank" rel="noopener noreferrer">templating<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <h3 id="runcommand-options"><a href="#runcommand-options" class="header-anchor">#</a> runCommand(options)</h3> <p>Run a system command. Hook options are the following:</p> <ul><li><strong>command</strong>: the template of the command to be run with the hook object as context (could be an array commands for a sequence)</li> <li><strong>spawn</strong>: <code>true</code> to use <code>child_process.spawn</code> instead of <code>child_process.exec</code> (default) to run the command(s), in that case a command is given as an array of args instead of a single string</li> <li><strong>stdout</strong>: boolean indicating if stdout is logged and stored in the hook object</li> <li><strong>stderr</strong>: boolean indicating if stderr is logged and stored in the hook object</li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Learn more about <a href="https://lodash.com/docs/4.17.4#template" target="_blank" rel="noopener noreferrer">templating<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <h3 id="envsubst-options"><a href="#envsubst-options" class="header-anchor">#</a> envsubst(options)</h3> <p>Provides file-level environment variable substitution. Hook options are the following:</p> <ul><li><strong>templateFile</strong>: the file to apply the substitution</li> <li><strong>outputFile</strong>: the resulting file</li> <li>any option supported by <strong>envusb</strong> for <a href="https://github.com/danday74/envsub#envsub--local-promise-based-usage" target="_blank" rel="noopener noreferrer">substituting<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="txt"><a href="#txt" class="header-anchor">#</a> TXT</h2> <p><a href="https://github.com/kalisio/krawler/blob/master/src/hooks/hooks.txt.js" target="_blank" rel="noopener noreferrer">source<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="readtxt-options"><a href="#readtxt-options" class="header-anchor">#</a> readTXT(options)</h3> <p>Read a TXT from an input stream/store and convert it to in-memory JSON values, hook options are the following:</p> <ul><li><strong>objectPath</strong>: property path where to read the KML object in the KML coming from the store, not defined by default so that the whole KML is retrieved</li> <li><strong>dataPath</strong>: property path where to store the resulting JSON object on the hook object, defaults to <code>result.data</code></li> <li><strong>storePath</strong>: see description in <a href="/krawler/reference/hooks.html#common-options">common options</a></li> <li><strong>store</strong>: see description in <a href="/krawler/reference/hooks.html#common-options">common options</a></li> <li><strong>key</strong>: see description in <a href="/krawler/reference/hooks.html#common-options">common options</a></li> <li><strong>transform</strong>: perform transformation using these options after read, see description in <a href="/krawler/reference/hooks.html#transformjson-options">transformJson</a></li></ul> <h2 id="utils"><a href="#utils" class="header-anchor">#</a> Utils</h2> <p><a href="https://github.com/kalisio/krawler/blob/master/src/hooks/hooks.utils.js" target="_blank" rel="noopener noreferrer">source<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="generateid-options"><a href="#generateid-options" class="header-anchor">#</a> generateId(options)</h3> <p>Generate a UUID (V1) for the item using <a href="https://github.com/kelektiv/node-uuid" target="_blank" rel="noopener noreferrer">node-uuid<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h3 id="template-options"><a href="#template-options" class="header-anchor">#</a> template(options)</h3> <p>Perform <a href="https://lodash.com/docs/4.17.4#template" target="_blank" rel="noopener noreferrer">templating<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> of the options using the item as context and merge it with item.</p> <h3 id="discardif-options"><a href="#discardif-options" class="header-anchor">#</a> discardIf(options)</h3> <p>Discard all subsequent hooks and task if the input data passes the given match filter options, filter options are similar to the match filter described in <a href="/krawler/reference/hooks.html#common-options">common options</a>.</p> <h3 id="apply-options"><a href="#apply-options" class="header-anchor">#</a> apply(options)</h3> <p>Apply a given function to the hook item(s), hook options are the following:</p> <ul><li><strong>function</strong>: a function taking the hook item(s) as input and updating it (can be async)</li></ul> <h3 id="healthcheck-options"><a href="#healthcheck-options" class="header-anchor">#</a> healthcheck(options)</h3> <p>Apply a given function to the hook item(s) and healthcheck structure, hook options are the following:</p> <ul><li><strong>function</strong>: a function taking the hook item(s) and healthcheck structure as input and updating it</li></ul> <h3 id="addoutputs-outputs"><a href="#addoutputs-outputs" class="header-anchor">#</a> addOutputs(outputs)</h3> <p>Declare a new output for the job/task, hook options is an array of objects with the following properties:</p> <ul><li><strong>name</strong>: the name of the output</li> <li><strong>type</strong>: the type of the output (defaults to <code>intermediate</code> so that it will be cleaned)</li></ul> <blockquote><p>Tasks and write hooks automatically track generated outputs but sometimes outputs are generated by an external process (eg. command hook) so that you need to declare it in order to properly clean it with the <a href="/krawler/reference/hooks.html#clearOutputs-options">clearOutputs</a> hook.</p></blockquote> <h3 id="emitevent-options"><a href="#emitevent-options" class="header-anchor">#</a> emitEvent(options)</h3> <p>Emit a <code>'krawler'</code> event on the underlying service, hook options are the following:</p> <ul><li><strong>type</strong>: the custom type of the event to be emitted</li> <li>any transformation option, see description in <a href="/krawler/reference/hooks.html#transformjson-options">transformJson</a>, the transformed object will be used as event payload in the <code>data</code> field</li></ul> <h2 id="xml"><a href="#xml" class="header-anchor">#</a> XML</h2> <p><a href="https://github.com/kalisio/krawler/blob/master/src/hooks/hooks.xml.js" target="_blank" rel="noopener noreferrer">source<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="readxml-options"><a href="#readxml-options" class="header-anchor">#</a> readXML(options)</h3> <p>Read an XML file from a store and convert it to in-memory JSON values, hook options are the following:</p> <ul><li><strong>dataPath</strong>: property path where to store the resulting JSON object on the hook object, defaults to <code>result.data</code></li> <li><strong>storePath</strong>: see description in <a href="/krawler/reference/hooks.html#common-options">common options</a></li> <li><strong>store</strong>: see description in <a href="/krawler/reference/hooks.html#common-options">common options</a></li> <li><strong>parser</strong>: the <a href="https://github.com/Leonidas-from-XIV/node-xml2js#options" target="_blank" rel="noopener noreferrer">parser options <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><strong>key</strong>: see description in <a href="/krawler/reference/hooks.html#common-options">common options</a></li></ul> <h2 id="yaml"><a href="#yaml" class="header-anchor">#</a> YAML</h2> <p><a href="https://github.com/kalisio/krawler/blob/master/src/hooks/hooks.yaml.js" target="_blank" rel="noopener noreferrer">source<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="readyaml-options"><a href="#readyaml-options" class="header-anchor">#</a> readYAML(options)</h3> <p>Read a YAML file from a store and convert it to in-memory JSON values, hook options are the following:</p> <ul><li><strong>dataPath</strong>: property path where to store the resulting JSON object on the hook object, defaults to <code>result.data</code></li> <li><strong>storePath</strong>: see description in <a href="/krawler/reference/hooks.html#common-options">common options</a></li> <li><strong>store</strong>: see description in <a href="/krawler/reference/hooks.html#common-options">common options</a></li> <li><strong>key</strong>: see description in <a href="/krawler/reference/hooks.html#common-options">common options</a></li></ul> <h3 id="writeyaml-options"><a href="#writeyaml-options" class="header-anchor">#</a> writeYAML(options)</h3> <p>Generate a YAML file from in-memory JSON values, hook options are the following:</p> <ul><li><strong>dataPath</strong>: property path where to read the input JSON object on the hook object, defaults to <code>result</code></li> <li><strong>storePath</strong>: see description in <a href="/krawler/reference/hooks.html#common-options">common options</a></li> <li><strong>store</strong>: see description in <a href="/krawler/reference/hooks.html#common-options">common options</a></li> <li><strong>key</strong>: see description in <a href="/krawler/reference/hooks.html#common-options">common options</a></li> <li><strong>outputType</strong>: the type of output produced by this hook, defaults to <code>intermediate</code></li> <li>any option supported by <a href="https://github.com/nodeca/js-yaml#safedump-object---options-" target="_blank" rel="noopener noreferrer">js-yaml<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/krawler/reference/services.html" class="prev">
        Services
      </a></span> <span class="next"><a href="/krawler/reference/known-issues.html">
        Known issues
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/krawler/assets/js/app.800cd291.js" defer></script><script src="/krawler/assets/js/3.b3661107.js" defer></script><script src="/krawler/assets/js/23.155a1fbd.js" defer></script><script src="/krawler/assets/js/4.26c8de0e.js" defer></script>
  </body>
</html>
